'use strict';var D=document,M=Math,W=window,$=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:D,c=0===a.indexOf('.'),d=0===a.indexOf('#');return c?b.getElementsByClassName(a.substr(1,a.length)):d?b.getElementById(a.substr(1,a.length)):b.getElementsByTagName(a)},draggableContainer=$('.draggables')[0],draggables=$('.drag'),maxZIndex=5*draggables.length,dragged=!1,startPos=!1,currentZIndex=1,forEach=function(a,b){for(var c=0;c<a.length;c++)a.hasOwnProperty(c)&&b(a[c])},cl={has:function c(a,b){return a.className&&-1<a.className.indexOf(b)},add:function c(a,b){cl.has(a,b)||(a.className=a.className?a.className+' '+b:b)},rm:function c(a,b){cl.has(a,b)&&(a.className=a.className.replace(b,'').trim())},toggle:function c(a,b){cl.has(a,b)?cl.rm(a,b):cl.add(a,b)}// resize and reposition after load of images
},onload=function(a){return function(b){if(cl.has(b.target,'bg')){var c=b.target,d=c.naturalWidth,e=c.naturalHeight,f=0,g=0,h=.7*W.innerWidth;// resize if too wide
if(d>h){var k=d/h+.1;d/=k,e/=k}// resize if too high
var l=.7*W.innerHeight;if(e>l){var m=e/l+.1;e/=m,d/=m}var i=W.innerWidth-d,j=W.innerHeight-e;f=M.random()*i,g=M.random()*j,f=M.floor(percentFromPixels('Width',f))+'%',g=M.floor(percentFromPixels('Height',g))+'%',a.style.left=f,a.style.top=g}}};// global app state
forEach(draggables,function(a){var b=M.random(),c={left:'100%',top:'100%'};.7<b?c.left='-'+c.left:.3>b&&(c.top='-'+c.top),a.style.left=c.left,a.style.top=c.top;var d=$('.bg',a)[0];d&&(d.addEventListener('load',onload(a)),d.src=d.src)});var touchHandler=function(a){var b=a.changedTouches[0],c=D.createEvent('MouseEvent'),d={touchstart:'mousedown',touchmove:'mousemove',touchend:'mouseup'}[a.type];return(c.initMouseEvent(d,!0,!0,W,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),cl.has(b.target,'bg')&&b.target===b.currentTarget)?(console.log('true'),!0):(b.target.dispatchEvent(c),a.preventDefault(),a.stopPropagation(),!1)},doNothing=function(a){return a.preventDefault(),!1},getPos=function(a){return parseInt(a.replace('%',''))},percentFromPixels=function(a,b){return 100*(b/W['inner'+a])},pixelsFromPercent=function(a,b){return b*W['inner'+a]/100},isOutOfBounds=function(a){return a.clientX>=W.innerWidth||0>=a.clientX||a.clientY>=W.innerHeight||0>=a.clientY},drag=function(a){dragged=a.currentTarget,cl.add(dragged,'dragged'),startPos={left:pixelsFromPercent('Width',getPos(dragged.style.left)),top:pixelsFromPercent('Height',getPos(dragged.style.top))},currentZIndex+=1,dragged.style.zIndex=currentZIndex,dragged.offset={left:a.clientX-pixelsFromPercent('Width',getPos(dragged.style.left)),top:a.clientY-pixelsFromPercent('Height',getPos(dragged.style.top))},dragged.style.opacity=.8,D.addEventListener('mousemove',mousemove),D.addEventListener('mouseup',drop),D.addEventListener('mouseout',dropIfOutOfBounds)},drop=function(){dragged&&(forEach(draggables,function(a){cl.rm(a,'dragged'),a===dragged?cl.add(dragged,'dropped'):cl.rm(a,'dropped')}),dragged.style.opacity=1,D.removeEventListener('mousemove',mousemove),D.removeEventListener('mouseup',drop),D.removeEventListener('mouseout',dropIfOutOfBounds),dragged=!1,startPos=!1)},dropIfOutOfBounds=function(a){isOutOfBounds(a)&&drop(a)},mousemove=function(a){if(dragged){var b={left:W.innerWidth-dragged.clientWidth,top:W.innerHeight-dragged.clientHeight},c=a.clientX-dragged.offset.left;0>c?c=0:c>b.left&&(c=b.left),dragged.style.left=percentFromPixels('Width',c)+'%';var d=a.clientY-dragged.offset.top;0>d?d=0:d>b.top&&(d=b.top),dragged.style.top=percentFromPixels('Height',d)+'%'}};W.onload=function(){forEach(draggables,function(b){b.addEventListener('dragstart',doNothing),b.addEventListener('mousedown',drag),b.addEventListener('touchstart',touchHandler,!0),b.addEventListener('touchmove',touchHandler,!0),b.addEventListener('touchend',touchHandler,!0),b.addEventListener('touchcancel',touchHandler,!0);var c=$('a',b)[0];c&&c.addEventListener('touchend',function(a){return a.stopPropagation(),!1})})};// Menu
var menuContainer=$('.nav')[0];if(menuContainer){var active=$('.active',menuContainer)[0],toggleMenu=function(a){return a.preventDefault(),cl.toggle(menuContainer,'show'),!1};active&&active.addEventListener('click',toggleMenu)}